gen5 KB5adv : 키 파일 보관/전송 시스템.
gen5 KB5recv : KB5adv 키 전송 테스트용 프로그램.
키 파일을 안전하게 보관/타 프로그램에 전송할 수 있는 프로그램입니다.

다음과 같은 구조로 키 파일을 저장합니다.
- 본 실행파일
- 암호화 가속 라이브러리
- 이름_en/ 폴더 (암호화된 키 파일이 저장됨.)
- 이름_de/ 폴더 (키 파일 추가나 내보내기 장소.)
이름 뒤에 _en과 _de가 모두 있는 폴더는 저장소로 취급됩니다.
저장 폴더는 여러 개 인식할 수 있으며, _en/_de 두 종류가 모두 있어야만 합니다.

이 프로그램을 시작으로 대부분의 gen5 프로그램은
키 파일을 직접 저장소에서 고르는 GUI와 함께
KB5adv로 통신하여 받아오는 방식도 지원할 예정입니다.
두 기능은 GUI 상에 바로 밑에 붙어 있으며, 대략 다음과 같은 UI입니다.

[버튼 A]   [   표시부 B   ]
[버튼 C]   [   입력부 D   ]
A와  B는 전통적인 저장소 선택 UI입니다. A를 누르면 저장소에 키 파일을 선택하고 이름이 B에 표시됩니다.
C와 D로는 통신을 통해 키 파일 받아오기를 할 수 있습니다.
D에 주소를 입력하고 C를 누르면 수신 결과와 키 파일 주소가 B에 표시됩니다.
주소는 다음과 같은 형태입니다. 12345.01.f6.7c.35 (포트 번호와 4바이트 세션 키입니다.)

<로그인>
키 파일과 비밀번호를 입력해서 로그인합니다. 처음 계정을 생성하지 않았다면 자동으로 계정이 생성됩니다.
계정 정보를 비롯한 키 파일 암호 정보는 모두 settings.webp 파일에 저장됩니다.

<상태창/보기창/설정창>
로그인에 성공했다면 창이 3개가 보입니다.
- ststus에서는 키 파일 관리, 다른 프로그램으로의 전송, 전체초기화(붐) 작업이 가능합니다.
- view에서는 ststus 창에서 선택한 파일을 보여줍니다. 만약 그 파일이 사진이라면 창에 그 사진이 표시됩니다.
- config에서는 메세지를 비롯한 KB5adv의 설정을 관리할 수 있습니다.

<ststus 창 기능>
- send는 선택한 파일을 다른 프로그램에 전송합니다. 10000~40000 사이 포트를 사용해 소켓 통신합니다.
- import는 새 키 파일을 가져옵니다. 이름_de 폴더에 있는 파일(평문)에 대해,
그 파일의 이름이 내부 저장소에 없다면 파일을 이름_en 폴더로 옮겨 암호화하고 원본은 삭제합니다.
또한 _en/_de 저장소의 불필요한 파일들을 전부 삭제해서 암호화된 키 파일만 남깁니다.
- export는 선택된 키 파일을 이름_de 폴더로 복호화합니다. 암호 파일은 삭제되지 않습니다.
생성된 원본 키 파일(평문)을 전부 지우려면 import기능을 사용하면 됩니다.
- boom은 데이터를 모두 지우며, 이 프로그램이 있는 드라이브를 설정 용량만큼 덮어쓰기합니다.
USB등에서 운용 시 키 파일 데이터를 전부 지우고 복구하지 못하게 방지합니다.

<config 창 기능>
config는 msg, boom, keyfile, password, hint, debug info, func button으로 구성됩니다.
- msg는 저장소 관련 메세지를 적어놓을 수 있는 공간입니다. 로그인해야 볼 수 있습니다.
- boom은 boom시 덮어쓰기하는 용량을 지정합니다. 오른쪽 선택창으로 용량 단위 지정이 가능합니다.
- keyfile reset 부분에서는 로그인 창과 마찬가지로 키 파일을 드라이브에서 직접 지정하거나,
다른 KB5adv 프로그램에서 받아 지정할 수 있습니다. 키 파일 변경 시 자동으로 메세지/비밀번호 등이 업데이트됩니다.
- password reset에서는 비밀번호 수정이 가능합니다.
- hint에서는 비밀번호에 대해 지정하는 힌트 구문을 변경할 수 있습니다.
- debug info에서는 현재 설정에 대한 내부 정보가 표시됩니다.
- 메세지 재설정 버튼은 msg/boom 설정만 업데이트합니다. 비밀번호 관련은 업데이트하지 않습니다.
- 비밀번호 재설정 버튼은 메세지 설정과 비밀번호 설정을 모두 업데이트합니다.

<주의>
- 비밀번호 재설정은 힌트 구문은 항상 업데이트되나, PW 보기가 활성화된 상태여야 비밀번호 수정/업데이트가 됩니다.
- boom 용량은 실제 드라이브(USB/SSD/HDD)의 용량을 차지하는 덮어쓰기입니다.
너무 큰 숫자로 설정하지 마시고 USB등 소용량 드라이브에서만 사용하세요.
- boom이 진행되면 모든 키 파일/사용자 메세지 등이 사라지고 다시 복구할 수 없습니다.

<keyfile transfer format>
stdlib5.kcom을 이용한 통신.
키 파일은 지정 위치에 48B 키로 암호화된 상태이다.
server 측에서 파일 위치와 48B 키를 소켓 통신으로 보낸다.
두 정보는 각각 문자열/바이트열 정보이며 stdlib5.kdb 문자열의 UTF-8 인코딩으로 보낸다.
kdb 문자열은 평문 정보이다. 이 평문의 crc32 정수 값을 문자열화 후 무결성 검증용으로 msg 항목으로 보낸다.
4B 키를 12번 반복해 48B로 만들고, 그것을 stdlib5.simen 키로 설정해 평문을 암호화한다.
실제 kcom으로 보내지는 것은 암호문 데이터와 msg 무결성 데이터이다.
수신 측에서는 client로 데이터를 받고 복호화한다. 그 후 crc32 무결성을 검증한다.
kdb로 데이터 해석이 끝나면 해당 위치의 파일을 읽고 48B 키로 복호화해 원본 키 파일 데이터를 얻을 수 있다.
이 과정은 KB5adv와 KB5recv로 시험해 볼 수 있다.
